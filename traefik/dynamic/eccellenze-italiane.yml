# Traefik dynamic configuration for Eccellenze Italiane TV
# App runs on host via PM2, not in Docker container
# TEMPORANEO: Scollegato da eccellenzeitaliane.tv - ora su sottodominio

http:
  routers:
    # Sottodominio temporaneo (attivo)
    eccellenze-italiane-temp:
      rule: "Host(`eccellenze-tv.fodivps1.cloud`) || Host(`eccellenze-italiane.fodivps1.cloud`)"
      entryPoints:
        - websecure
      service: eccellenze-italiane
      tls:
        certResolver: letsencrypt
      middlewares:
        - eccellenze-italiane-headers
        - eccellenze-italiane-ratelimit

    # Dominio ufficiale - DISATTIVATO (commentato)
    # eccellenze-italiane-tv:
    #   rule: "Host(`eccellenzeitaliane.tv`) || Host(`www.eccellenzeitaliane.tv`)"
    #   entryPoints:
    #     - websecure
    #   service: eccellenze-italiane
    #   tls:
    #     certResolver: letsencrypt
    #   middlewares:
    #     - eccellenze-italiane-headers
    #     - eccellenze-italiane-ratelimit

  services:
    eccellenze-italiane:
      loadBalancer:
        servers:
          - url: "http://172.19.0.1:3011"

  middlewares:
    eccellenze-italiane-headers:
      headers:
        sslRedirect: true
        stsSeconds: 31536000
        stsIncludeSubdomains: true
        stsPreload: true
        frameDeny: true
        contentTypeNosniff: true
        browserXssFilter: true
        forceSTSHeader: true
        customFrameOptionsValue: "DENY"
        referrerPolicy: "strict-origin-when-cross-origin"
        permissionsPolicy: "geolocation=(), microphone=(), camera=()"

    eccellenze-italiane-ratelimit:
      rateLimit:
        average: 100
        burst: 200
        period: 1m
